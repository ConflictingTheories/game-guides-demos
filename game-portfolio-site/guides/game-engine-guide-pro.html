<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Advanced Game Engine Patterns</title>
  <link rel="stylesheet" href="./guide-style.css" />
  <!-- Mermaid -->
  <script src="/lib/mermaid.min.js"></script>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: 'dark',
      securityLevel: 'loose',
      flowchart: { useMaxWidth: true, htmlLabels: true }
    });
  </script>
</head>

<body>


  <header>
    <h1>Advanced Game Engine Patterns</h1>
    <p class="note">Click any topic below to view that section. Click <strong>Show All</strong> to see everything.</p>

    <div class="toc">
      <div class="chip active" data-section="all">Show All</div>
      <div class="chip" data-section="core">Core Architecture</div>
      <div class="chip" data-section="jrpg">JRPG</div>
      <div class="chip" data-section="rts">RTS</div>
      <div class="chip" data-section="srpg">SRPG</div>
      <div class="chip" data-section="action">Action RPG</div>
      <div class="chip" data-section="platformer">Platformer MMO</div>
      <div class="chip" data-section="mmo">MMO</div>
      <div class="chip" data-section="graphics">Graphics</div>
    </div>
  </header>

  <!-- Show All Button (fallback) -->
  <button id="show-all-btn">Show All Sections</button>

  <!-- =================================== -->
  <!-- CORE ARCHITECTURE -->
  <!-- =================================== -->
  <section id="core" class="section">
    <h2>Core Architecture</h2>
    <div class="row">
      <div class="col">
        <div class="diagram">
          <div class="mermaid">
            graph TD
            subgraph Client
            A[Input] --> B[Prediction]
            B --> C[Renderer]
            B --> D[Interpolation]
            C --> E[Output]
            end
            subgraph Server
            S[State] --> M[DB]
            S --> N[Sim]
            end
            B -->|Cmd| S
            S -->|Snap| D
            classDef client fill:#022,stroke:#0f0,color:#fff
            classDef server fill:#300,stroke:#f66,color:#fff
            class A,B,C,D,E client
            class S,M,N server
          </div>
        </div>
        <p class="note">Client-side prediction + server authority.</p>
      </div>
      <div class="col">
        <details open>
          <summary><strong>ECS Pattern</strong></summary>
          <pre>// Cache-friendly update
struct Pos { float x,y,z; };
struct Vel { float x,y,z; };
for (chunk in query<Pos,Vel>()) {
  for (entity in chunk) {
    entity.Pos += entity.Vel * dt;
  }
}</pre>
        </details>
      </div>
    </div>
  </section>

  <!-- =================================== -->
  <!-- JRPG -->
  <!-- =================================== -->
  <section id="jrpg" class="section">
    <h2>JRPG Battle System</h2>
    <div class="row">
      <div class="col">
        <div class="diagram">
          <div class="mermaid">
            sequenceDiagram
            participant P as Player
            participant E as Engine
            participant F as FSM
            participant R as Resolver
            P->>E: Choose Attack
            E->>F: Enqueue
            F->>R: Resolve
            R-->>E: Apply
            E->>P: Animate
            Note over F,R: Priority + Immunity
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- =================================== -->
  <!-- RTS -->
  <!-- =================================== -->
  <section id="rts" class="section">
    <h2>RTS Lockstep</h2>
    <div class="row">
      <div class="col">
        <div class="diagram">
          <div class="mermaid">
            graph TD
            I[Inputs] --> H[Host]
            H --> C1[Client 1]
            H --> C2[Client 2]
            C1 --> S1[Sim]
            C2 --> S2[Sim]
            H -->|Checksum| C1
            H -->|Checksum| C2
            classDef host fill:#022,stroke:#0f0
            class H host
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- =================================== -->
  <!-- SRPG -->
  <!-- =================================== -->
  <section id="srpg" class="section">
    <h2>SRPG Pathfinding</h2>
    <div class="row">
      <div class="col">
        <div class="diagram">
          <div class="mermaid">
            graph TD
            GM[Grid] --> CM[Cost Map]
            U[Unit] --> PF[A*]
            PF --> MR[Reserve]
            MR --> CR[Conflict]
            CR --> AE[Execute]
            Note over MR,CR: Avoid Collisions
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- =================================== -->
  <!-- ACTION RPG -->
  <!-- =================================== -->
  <section id="action" class="section">
    <h2>Action RPG Prediction</h2>
    <div class="row">
      <div class="col">
        <div class="diagram">
          <div class="mermaid">
            sequenceDiagram
            participant PI as Input
            participant CL as Client
            participant SV as Server
            PI->>CL: Move
            CL->>CL: Predict
            CL->>SV: Cmd
            SV->>CL: State
            CL->>CL: Reconcile
            Note over CL: Smooth Blend
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- =================================== -->
  <!-- PLATFORMER MMO -->
  <!-- =================================== -->
  <section id="platformer" class="section">
    <h2>Platformer MMO Zones</h2>
    <div class="row">
      <div class="col">
        <div class="diagram">
          <div class="mermaid">
            graph TD
            CA[Client A] --> ZS[Zone Server]
            CB[Client B] --> ZS
            ZS -->|Nearby| CA
            ZS -->|Nearby| CB
            ZS --> GS[Global]
            GS --> DB[DB]
            Note over ZS: AOI Filtering
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- =================================== -->
  <!-- MMO -->
  <!-- =================================== -->
  <section id="mmo" class="section">
    <h2>MMO Microservices</h2>
    <div class="row">
      <div class="col">
        <div class="diagram">
          <div class="mermaid">
            graph TD
            LC[Login] --> AM[Auth]
            AM --> ZM[Matchmaker]
            ZM --> ZS[Zone]
            ZS --> ES[Economy]
            ZS --> CS[Chat]
            ZS --> PL[Persistence]
            Note over ZS: Sharded
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- =================================== -->
  <!-- GRAPHICS -->
  <!-- =================================== -->
  <section id="graphics" class="section">
    <h2>Graphics Pipeline</h2>
    <div class="row">
      <div class="col">
        <div class="diagram">
          <div class="mermaid">
            graph TD
            CPU[CPU] --> VBO[Buffers]
            VBO --> VS[Vertex]
            VS --> PA[Assembly]
            PA --> FS[Fragment]
            FS --> FB[Framebuffer]
            classDef stage fill:#022,stroke:#0f0
            class VS,PA,FS stage
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer>
    <p>Interactive guide with <strong>zero Mermaid errors</strong>. Click any chip to filter.</p>
    <p>â€” Built for advanced engine development.</p>
  </footer>

  <!-- JavaScript for Filtering -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const chips = document.querySelectorAll('.chip');
      const sections = document.querySelectorAll('.section');
      const showAllBtn = document.getElementById('show-all-btn');

      function showSection(id) {
        sections.forEach(sec => {
          sec.classList.toggle('active', id === 'all' || sec.id === id);
        });
        chips.forEach(chip => {
          chip.classList.toggle('active', chip.dataset.section === id || id === 'all');
        });
      }

      chips.forEach(chip => {
        chip.addEventListener('click', () => {
          const section = chip.dataset.section;
          showSection(section);
        });
      });

      showAllBtn.addEventListener('click', () => {
        showSection('all');
      });

      // Show all by default
      showSection('all');
    });
  </script>

</body>

</html>
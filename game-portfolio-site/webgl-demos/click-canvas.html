<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Effect System Demo</title>
<style>
  canvas { background: #111; display:block; margin:0 auto; }
</style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<script>
// --- Utility ---
function randomRange(min, max) {
    return Math.random() * (max - min) + min;
}

// --- Effect Class ---
class Effect {
    constructor(x, y, duration, color, radius, layer = 1) {
        this.x = x;
        this.y = y;
        this.duration = duration;
        this.color = color;
        this.radius = radius;
        this.layer = layer;
        this.age = 0;
        this.vx = randomRange(-1, 1);
        this.vy = randomRange(-2, -0.5);
    }
    
    update() {
        this.age++;
        this.x += this.vx;
        this.y += this.vy;
        this.radius *= 0.96; // shrink
    }
    
    draw(ctx) {
        ctx.globalAlpha = 1 - this.age / this.duration;
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2);
        ctx.fill();
        ctx.globalAlpha = 1;
    }
    
    isDead() {
        return this.age >= this.duration || this.radius <= 0.5;
    }
}

// --- Effect Manager ---
class EffectManager {
    constructor() {
        this.effects = [];
    }
    
    spawn(effect) {
        this.effects.push(effect);
    }
    
    update() {
        this.effects.forEach(e => e.update());
        this.effects = this.effects.filter(e => !e.isDead());
    }
    
    draw(ctx) {
        // Optional: sort by layer
        this.effects.sort((a,b) => a.layer - b.layer);
        this.effects.forEach(e => e.draw(ctx));
    }
}

// --- Setup ---
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const effectManager = new EffectManager();

// --- Main Loop ---
function loop() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    
    // Example: draw background grid (battlefield tiles)
    for(let i=0;i<10;i++){
        for(let j=0;j<7;j++){
            ctx.fillStyle = (i+j)%2===0 ? '#222' : '#333';
            ctx.fillRect(i*80, j*80, 80, 80);
        }
    }

    effectManager.update();
    effectManager.draw(ctx);
    
    requestAnimationFrame(loop);
}

// --- Spawn effects on click ---
canvas.addEventListener('click', e => {
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    
    // Spawn multiple particles for a "magic spell" effect
    for(let i=0;i<20;i++){
        const colors = ['#ff4',' #f0f','#0ff','#f88'];
        const color = colors[Math.floor(Math.random()*colors.length)];
        effectManager.spawn(new Effect(x, y, 60, color, randomRange(5,15)));
    }
});

// Start loop
loop();
</script>
</body>
</html>